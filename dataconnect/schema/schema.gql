# ApplyNow Job Application Management Platform Schema

# User table is keyed by Firebase Auth UID.
type User @table {
  # `@default(expr: "auth.uid")` sets it to Firebase Auth UID during insert and upsert.
  id: String! @default(expr: "auth.uid")
  email: String! @col(dataType: "varchar(255)")
  name: String! @col(dataType: "varchar(100)")
  subscriptionPlan: SubscriptionPlan! @default(value: "FREE")
  subscriptionStatus: String! @default(value: "active") @col(dataType: "varchar(20)")
  subscriptionStartDate: Date
  subscriptionEndDate: Date
  isAdmin: Boolean! @default(value: false)
  createdAt: Date! @default(expr: "request.time")
  updatedAt: Date! @default(expr: "request.time")
}

# Subscription plans enum
enum SubscriptionPlan {
  FREE
  PLUS
  PRO
  ADMIN
}

# Job Applications table
type JobApplication @table {
  id: UUID! @default(expr: "uuidV4()")
  user: User!
  companyName: String! @col(dataType: "varchar(255)")
  jobTitle: String! @col(dataType: "varchar(255)")
  jobUrl: String @col(dataType: "text")
  applicationDate: Date! @default(expr: "request.time")
  status: String! @default(value: "applied") @col(dataType: "varchar(50)")
  notes: String @col(dataType: "text")
  resumeVersion: String @col(dataType: "varchar(100)")
  coverLetter: String @col(dataType: "text")
  salary: String @col(dataType: "varchar(100)")
  location: String @col(dataType: "varchar(255)")
  createdAt: Date! @default(expr: "request.time")
  updatedAt: Date! @default(expr: "request.time")
}

# Resumes table
type Resume @table {
  id: UUID! @default(expr: "uuidV4()")
  user: User!
  title: String! @col(dataType: "varchar(255)")
  content: String! @col(dataType: "text")
  isDefault: Boolean! @default(value: false)
  version: Int! @default(value: 1)
  createdAt: Date! @default(expr: "request.time")
  updatedAt: Date! @default(expr: "request.time")
}

# Admin users table for managing admin access
type AdminUser @table {
  id: UUID! @default(expr: "uuidV4()")
  email: String! @col(dataType: "varchar(255)") @unique
  name: String! @col(dataType: "varchar(100)")
  role: String! @default(value: "admin") @col(dataType: "varchar(50)")
  isActive: Boolean! @default(value: true)
  createdBy: String @col(dataType: "varchar(255)")
  createdAt: Date! @default(expr: "request.time")
  updatedAt: Date! @default(expr: "request.time")
}

# Subscription transactions for payment tracking
type SubscriptionTransaction @table {
  id: UUID! @default(expr: "uuidV4()")
  user: User!
  plan: SubscriptionPlan!
  amount: Float!
  currency: String! @default(value: "USD") @col(dataType: "varchar(3)")
  paymentMethod: String @col(dataType: "varchar(50)")
  transactionId: String @col(dataType: "varchar(255)")
  status: String! @default(value: "pending") @col(dataType: "varchar(20)")
  createdAt: Date! @default(expr: "request.time")
  completedAt: Date
}
